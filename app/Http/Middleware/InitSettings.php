<?php
/*
* Copyright (C) Incevio Systems, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Munna Khan <help.zcart@gmail.com>, September 2018
*/
 namespace App\Http\Middleware; use Auth; use View; use Closure; use App\Helpers\ListHelper; use Illuminate\Support\Facades\Cache; class InitSettings { public function handle($request, Closure $next) { if (!$request->is("\x69\x6e\163\x74\x61\x6c\154\x2a")) { goto z43FX; } return $next($request); z43FX: setSystemConfig(); View::addNamespace("\x74\x68\145\x6d\x65", theme_views_path()); if (!Auth::guard("\167\145\x62")->check()) { goto wPkbh; } if ($request->is("\141\x64\x6d\151\156\57\52") || $request->is("\x61\x63\x63\157\x75\156\x74\x2f\52")) { goto TAb3I; } return $next($request); goto hE6Iz; TAb3I: $this->can_load(); hE6Iz: if (!$request->session()->has("\151\x6d\160\145\x72\163\157\x6e\x61\x74\x65\144")) { goto xN8ax; } Auth::onceUsingId($request->session()->get("\151\155\x70\x65\162\x73\157\x6e\x61\x74\145\144")); xN8ax: $user = Auth::guard("\x77\145\142")->user(); if (!(!$user->isFromPlatform() && $user->merchantId())) { goto Sqh3V; } setShopConfig($user->merchantId()); Sqh3V: $permissions = Cache::remember("\x70\145\162\x6d\x69\163\163\x69\157\156\x73\x5f" . $user->id, system_cache_remember_for(), function () { return ListHelper::authorizations(); }); $permissions = isset($extra_permissions) ? array_merge($extra_permissions, $permissions) : $permissions; config()->set("\160\145\x72\x6d\x69\x73\x73\151\x6f\x6e\163", $permissions); if (!$user->isSuperAdmin()) { goto RtC5q; } $slugs = Cache::remember("\163\x6c\165\x67\163", system_cache_remember_for(), function () { return ListHelper::slugsWithModulAccess(); }); config()->set("\141\165\164\x68\123\154\165\x67\x73", $slugs); RtC5q: wPkbh: return $next($request); } private function can_load() { if (!(ZCART_MIX_KEY != "\60\61\x37\142\146\x38\142\x63\70\x38\x35\x66\142\63\67\x62" || md5_file(base_path() . "\57\142\x6f\x6f\x74\163\x74\162\141\160\x2f\141\x75\164\x6f\x6c\x6f\x61\144\x2e\160\x68\160") != "\64\x38\145\x32\x64\67\x31\x32\67\x33\x66\x31\x30\x30\70\143\65\x31\x33\145\70\x62\x38\x64\144\70\71\62\x33\x31\x31\60")) { goto uLhKf; } die("\104\151\x64\x20\x79\157\165\x20" . "\x72\x65\x6d\157\x76\145\x20\164\x68\145\x20" . "\157\154\x64\x20\x66\151\x6c\x65\163\40" . "\x21\77"); uLhKf: incevioAutoloadHelpers(getMysqliConnection()); } }